function formatDate(date){var hours=date.getHours(),minutes=date.getMinutes(),ampm=hours>=12?"pm":"am";hours%=12,hours=hours?hours:12,minutes=minutes<10?"0"+minutes:minutes;var strTime=hours+":"+minutes+" "+ampm;return date.getMonth()+1+"/"+date.getDate()+"/"+date.getFullYear()+" "+strTime}function dynamicSort(property){var sortOrder=1;return"-"===property[0]&&(sortOrder=-1,property=property.substr(1)),function(a,b){var result=a[property]<b[property]?-1:a[property]>b[property]?1:0;return result*sortOrder}}function liquidFillGaugeDefaultSettings(){return{minValue:0,maxValue:100,circleThickness:.1,circleFillGap:.02,circleColor:"#178BCA",waveHeight:.05,waveCount:1,waveRiseTime:1e3,waveAnimateTime:18e3,waveRise:!0,waveHeightScaling:!0,waveAnimate:!0,waveColor:"#178BCA",waveOffset:0,textVertPosition:.5,textSize:1,valueCountUp:!0,displayPercent:!0,textColor:"#fff",waveTextColor:"rgba(255,255,255,.5)"}}function loadLiquidFillGauge(elementId,value,config){function animateWave(){wave.attr("transform","translate("+waveAnimateScale(wave.attr("T"))+",0)"),wave.transition().duration(config.waveAnimateTime*(1-wave.attr("T"))).ease("linear").attr("transform","translate("+waveAnimateScale(1)+",0)").attr("T",1).each("end",function(){wave.attr("T",0),animateWave(config.waveAnimateTime)})}function GaugeUpdater(){this.update=function(value){var newFinalValue=parseFloat(value).toFixed(2),textRounderUpdater=function(value){return Math.round(value)};parseFloat(newFinalValue)!=parseFloat(textRounderUpdater(newFinalValue))&&(textRounderUpdater=function(value){return parseFloat(value).toFixed(1)}),parseFloat(newFinalValue)!=parseFloat(textRounderUpdater(newFinalValue))&&(textRounderUpdater=function(value){return parseFloat(value).toFixed(2)});var textTween=function(){var i=d3.interpolate(this.textContent,parseFloat(value).toFixed(2));return function(t){this.textContent=textRounderUpdater(i(t))+percentText}};text1.transition().duration(config.waveRiseTime).tween("text",textTween),text2.transition().duration(config.waveRiseTime).tween("text",textTween);var newClipArea,fillPercent=Math.max(config.minValue,Math.min(config.maxValue,value))/config.maxValue,waveHeight=fillCircleRadius*waveHeightScale(100*fillPercent),waveRiseScale=d3.scale.linear().range([fillCircleMargin+2*fillCircleRadius+waveHeight,fillCircleMargin-waveHeight]).domain([0,1]),newHeight=waveRiseScale(fillPercent),waveScaleX=d3.scale.linear().range([0,waveClipWidth]).domain([0,1]),waveScaleY=d3.scale.linear().range([0,waveHeight]).domain([0,1]);newClipArea=config.waveHeightScaling?d3.svg.area().x(function(d){return waveScaleX(d.x)}).y0(function(d){return waveScaleY(Math.sin(2*Math.PI*config.waveOffset*-1+2*Math.PI*(1-config.waveCount)+2*d.y*Math.PI))}).y1(function(d){return 2*fillCircleRadius+waveHeight}):clipArea;var newWavePosition=config.waveAnimate?waveAnimateScale(1):0;wave.transition().duration(0).transition().duration(config.waveAnimate?config.waveAnimateTime*(1-wave.attr("T")):config.waveRiseTime).ease("linear").attr("d",newClipArea).attr("transform","translate("+newWavePosition+",0)").attr("T","1").each("end",function(){config.waveAnimate&&(wave.attr("transform","translate("+waveAnimateScale(0)+",0)"),animateWave(config.waveAnimateTime))}),waveGroup.transition().duration(config.waveRiseTime).attr("transform","translate("+waveGroupXPosition+","+newHeight+")")}}void 0===config&&(config=liquidFillGaugeDefaultSettings());var gauge=d3.select("#"+elementId),radius=Math.min(parseInt(gauge.style("width")),parseInt(gauge.style("height")))/2,locationX=parseInt(gauge.style("width"))/2-radius,locationY=parseInt(gauge.style("height"))/2-radius;console.log(config);var waveHeightScale,fillPercent=Math.max(config.minValue,Math.min(config.maxValue,value))/config.maxValue;waveHeightScale=config.waveHeightScaling?d3.scale.linear().range([0,config.waveHeight,0]).domain([0,50,100]):d3.scale.linear().range([config.waveHeight,config.waveHeight]).domain([0,100]);var textPixels=config.textSize*radius/2,textFinalValue=parseFloat(value).toFixed(2),textStartValue=config.valueCountUp?config.minValue:textFinalValue,percentText=config.displayPercent?"%":"",circleThickness=config.circleThickness*radius,circleFillGap=config.circleFillGap*radius,fillCircleMargin=circleThickness+circleFillGap,fillCircleRadius=radius-fillCircleMargin,waveHeight=fillCircleRadius*waveHeightScale(100*fillPercent),waveLength=2*fillCircleRadius/config.waveCount,waveClipCount=1+config.waveCount,waveClipWidth=waveLength*waveClipCount,textRounder=function(value){return Math.round(value)};parseFloat(textFinalValue)!=parseFloat(textRounder(textFinalValue))&&(textRounder=function(value){return parseFloat(value).toFixed(1)}),parseFloat(textFinalValue)!=parseFloat(textRounder(textFinalValue))&&(textRounder=function(value){return parseFloat(value).toFixed(2)});for(var data=[],i=0;i<=40*waveClipCount;i++)data.push({x:i/(40*waveClipCount),y:i/40});var gaugeCircleX=d3.scale.linear().range([0,2*Math.PI]).domain([0,1]),gaugeCircleY=d3.scale.linear().range([0,radius]).domain([0,radius]),waveScaleX=d3.scale.linear().range([0,waveClipWidth]).domain([0,1]),waveScaleY=d3.scale.linear().range([0,waveHeight]).domain([0,1]),waveRiseScale=d3.scale.linear().range([fillCircleMargin+2*fillCircleRadius+waveHeight,fillCircleMargin-waveHeight]).domain([0,1]),waveAnimateScale=d3.scale.linear().range([0,waveClipWidth-2*fillCircleRadius]).domain([0,1]),textRiseScaleY=d3.scale.linear().range([fillCircleMargin+2*fillCircleRadius,fillCircleMargin+.7*textPixels]).domain([0,1]),gaugeGroup=gauge.append("g").attr("transform","translate("+locationX+","+locationY+")"),gaugeCircleArc=d3.svg.arc().startAngle(gaugeCircleX(0)).endAngle(gaugeCircleX(1)).outerRadius(gaugeCircleY(radius)).innerRadius(gaugeCircleY(radius-circleThickness));gaugeGroup.append("path").attr("d",gaugeCircleArc).attr("class","fill-color-0").attr("transform","translate("+radius+","+radius+")");var text1=gaugeGroup.append("text").text(textRounder(textStartValue)+percentText).attr("class","liquidFillGaugeText").attr("text-anchor","middle").attr("font-size",textPixels+"px").style("fill",config.textColor).attr("transform","translate("+radius+","+textRiseScaleY(config.textVertPosition)+")"),clipArea=d3.svg.area().x(function(d){return waveScaleX(d.x)}).y0(function(d){return waveScaleY(Math.sin(2*Math.PI*config.waveOffset*-1+2*Math.PI*(1-config.waveCount)+2*d.y*Math.PI))}).y1(function(d){return 2*fillCircleRadius+waveHeight}),waveGroup=gaugeGroup.append("defs").append("clipPath").attr("id","clipWave"+elementId),wave=waveGroup.append("path").datum(data).attr("d",clipArea).attr("T",0),fillCircleGroup=gaugeGroup.append("g").attr("clip-path","url(#clipWave"+elementId+")");fillCircleGroup.append("circle").attr("cx",radius).attr("cy",radius).attr("r",fillCircleRadius).attr("class","fill-color-1");var text2=fillCircleGroup.append("text").text(textRounder(textStartValue)+percentText).attr("class","liquidFillGaugeText").attr("text-anchor","middle").attr("font-size",textPixels+"px").style("fill",config.waveTextColor).attr("transform","translate("+radius+","+textRiseScaleY(config.textVertPosition)+")");if(config.valueCountUp){var textTween=function(){var i=d3.interpolate(this.textContent,textFinalValue);return function(t){this.textContent=textRounder(i(t))+percentText}};text1.transition().duration(config.waveRiseTime).tween("text",textTween),text2.transition().duration(config.waveRiseTime).tween("text",textTween)}var waveGroupXPosition=fillCircleMargin+2*fillCircleRadius-waveClipWidth;return config.waveRise?waveGroup.attr("transform","translate("+waveGroupXPosition+","+waveRiseScale(0)+")").transition().duration(config.waveRiseTime).attr("transform","translate("+waveGroupXPosition+","+waveRiseScale(fillPercent)+")").each("start",function(){wave.attr("transform","translate(1,0)")}):waveGroup.attr("transform","translate("+waveGroupXPosition+","+waveRiseScale(fillPercent)+")"),config.waveAnimate&&animateWave(),new GaugeUpdater}function resRef(obj,str){return str.split(".").reduce(function(o,x){return"undefined"!=typeof o?o[x]:void console.log("There is missing data within object ",o," referenced by :",x)},obj)}var PARTICLE=angular.module("PARTICLE",["ngAnimate","ui.router","jsonFormatter"]);PARTICLE.provider("centralObject",function(){var obj={};return{set:function(property,value){console.log("Setting centralObject."+property+" to "+value),obj[property]=value},$get:function(){return obj}}}),PARTICLE.config(function($stateProvider,$urlRouterProvider,CONFIG,centralObjectProvider){var applicationStates=[],returnStateFromObject=function(obj,type,parentName,arrayOfStates){if("object"==typeof obj){var slug="",stateProperties={},singleType=type;return slug=null!=parentName?parentName+"."+obj.slug:""+obj.slug,"s"==singleType.charAt(singleType.length-1)&&(singleType=singleType.substr(0,singleType.length-1)),stateProperties.params={},stateProperties.params[type]={},stateProperties.hash=obj._id,stateProperties.title=obj.title,"collections"==type?(stateProperties.templateUrl=CONFIG.viewPath+"sections.html",stateProperties.controller="content",stateProperties.views={"":{templateUrl:CONFIG.viewPath+"sections.html",controller:"content"},headerContent:{templateUrl:CONFIG.viewPath+"header-content.html",controller:"content"},rightSidebar:{templateUrl:CONFIG.viewPath+"header-content.html",controller:"questions"},relatedContent:{templateUrl:CONFIG.viewPath+"related-content.html",controller:"content"}},stateProperties.params.contentFile=CONFIG.contentPath+type+"/"+obj._id+CONFIG.contentFileSuffix):(stateProperties.templateUrl=CONFIG.viewPath+type+".html",stateProperties.params.state=slug),stateProperties.name=slug,stateProperties.url="/"+obj.slug,$stateProvider.state(slug,stateProperties),stateProperties.subs=[],stateProperties}return null},makeCollectionIntoStates=function(obj,parentName,arrayOfStates){var newParent,newParentName=null;for(var property in obj)if(obj.hasOwnProperty(property)&&CONFIG.collectionsStateObjects.inArray(property)&&Array.isArray(obj[property])&&obj[property].length)for(var inst in obj[property])obj[property].hasOwnProperty(inst)&&(newParent=returnStateFromObject(obj[property][inst],property,parentName,arrayOfStates),null!==newParent&&(arrayOfStates.push(newParent),newParentName=newParent.name,makeCollectionIntoStates(obj[property][inst],newParentName,newParent.subs)))};$stateProvider.state("home",{url:"/",views:{"":{templateUrl:CONFIG.viewPath+"home.html"},tagline:{templateUrl:CONFIG.viewPath+"tagline.html"},headerContent:{templateUrl:CONFIG.viewPath+"home-header.html"},rightSidebar:{templateUrl:CONFIG.viewPath+"questions.html",controller:"questions"},relatedContent:{template:""}}}),$urlRouterProvider.otherwise("/");var objs={};objs.collections=CONFIG.nav,makeCollectionIntoStates(objs,null,applicationStates),centralObjectProvider.set("applicationStates",applicationStates),centralObjectProvider.set("config",CONFIG)}),PARTICLE.controller("content",function($scope,$stateParams,$state,$sce,dataIo,CONFIG){$scope.CONFIG=CONFIG,dataIo.getFile({file:$stateParams.contentFile}).then(function(_data){$scope.content=dataIo.parseContent(_data.data[Object.keys(_data.data)[0]])})["catch"](function(_data){$scope.content=_data})}),PARTICLE.controller("questions",function($scope,$stateParams,$state,$sce,dataIo,CONFIG){$scope.CONFIG=CONFIG,log_q($stateParams),dataIo.getFile({file:CONFIG.contentPath+"questions.json"}).then(function(_data){$scope.content=dataIo.parseContent(_data.data[Object.keys(_data.data)[0]])})["catch"](function(_data){$scope.content=_data})}),PARTICLE.controller("ui",function($scope,centralObject,$timeout){$scope.CONFIG=centralObject.config,$scope.applicationStates=centralObject.applicationStates,$scope.centralObject=centralObject,$timeout(function(){$(document).foundation()},2e3)}),PARTICLE.directive("smartChart",function($parse,$window,$timeout){var directiveDefinitionObject={restrict:"E",replace:!1,scope:{config:"=",datasets:"=",colors:"=",percentcomplete:"=",successpercent:"=",max:"=",min:"=",mockup:"=",index:"="},link:function(scope,element,attrs){var drawn=0;$timeout(function(){element.parent().height()&&0===drawn&&(drawMe(),drawn=1)},1);var drawMe=function(indexval){if(console.log("BARCHART DARW"),null===indexval)return null;var width,height,dataset,layers,config={chartInset:0,hasSuccessIndicator:!0,hasBandIndicator:!1,margin:{top:20,right:20,bottom:60,left:60},barWidth:10,widthPercentSize:1.1,needLength:1,colors:{primary_fill:"color-pewter",color_2:"boldorange-0-fade-1",success:"color-bluepuddy-0-fade-5",needle:"color-pewter-0-fade-0",bg:"color-white-6-fade-8",legend:"color-bluepuddy-8-fade-0"},max:100,min:0};void 0!==scope.config&&Object.keys(scope.config).forEach(function(key,index){config[key]=scope.config[key]}),el=d3.select(element[0]),width=element[0].parentElement.clientWidth,height=200,dataset=scope.datasets;var spending=["DME","OM"];d3.time.format("%m/%Y").parse;layers=sub.map(function(d){return{x:d.date,y:+d.rating,y0:0}}),layers=d3.layout.stack()(spending.map(function(c){return dataset.map(function(d){return{x:d.date,y:d[c]}})})),xScale=d3.time.scale().domain([startdate,enddate]).range([0+config.margin.left,width-config.margin.right]),yScale=d3.scale.linear().domain([0,5]).range([height-config.margin.bottom,config.margin.top]).nice();var x=d3.scale.ordinal().rangeRoundBands([0,width]),y=d3.scale.linear().rangeRound([height,0]),chart=(d3.scale.category10(),el.append("svg").attr("height",height).attr("width",width).attr("class","chart")),xAxis=d3.svg.axis().scale(x).orient("bottom").tickFormat(d3.time.format("%b")),yAxis=d3.svg.axis().scale(y).orient("left"),yTick=(chart.append("g").attr("id","xaxis"+indexval).attr("class","axis x").attr("transform","translate(0, "+(height-config.margin.bottom)+")").call(xAxis).selectAll("text").style("text-anchor",function(d){return 0!==d.getMonth()?"middle":"start"}).attr("dy","10px").attr("transform",function(d){if(0!==d.getMonth())return"translate("+xtickdist/2+", 0)"}).style("font-weight",function(d){if(0===d.getMonth())return"bold"}),chart.append("g").attr("id","yaxis"+indexval).attr("class","axis y").attr("transform","translate("+config.margin.left+",0)").call(yAxis).selectAll("text").attr("transform","translate(0, "+ytickdist/2+")").style("text-anchor","middle").text(function(d){return"0"==d?null:d}),(height-config.margin.top-config.margin.bottom)/yticks);console.log(yTick),d3.select("#yaxis"+indexval).append("text").attr("x",(-height+config.margin.bottom+config.margin.top)/2-config.margin.top).attr("y",-config.margin.left/2).attr("transform","rotate(-90)").attr("text-anchor","middle").style("font-weight","bold").text("Rating"),d3.select("#xaxis"+indexval).append("text").attr("y",50).attr("x",.5*width).attr("text-anchor","middle").style("font-weight","bold").text("Submission Date");chart.selectAll("rect").data(layers).enter().append("rect").attr("x",function(d){return xScale(d.x)}).attr("y",function(d){return yScale(d.y0+d.y)}).attr("width",config.barWidth).attr("height",function(d){return yScale(d.y0)-yScale(d.y+d.y0)}).attr("date",function(d){return d.x}).attr("rating",function(d){return d.y}).style("fill",function(d){return 3==d.y?"#f78c00":"1"==d.y|"2"==d.y?"#b30000":"4"==d.y|"5"==d.y?"#007844":"#000"})};drawMe()}};return directiveDefinitionObject}),PARTICLE.directive("bulletChart",function($parse,$window,$timeout){var directiveDefinitionObject={restrict:"E",replace:!0,scope:{member:"=",target:"=",rangestart:"=",rangeend:"=",current:"=",colors:"=",ratio:"=",delay:"=",alttext:"="},link:function(scope,element,attrs){var width,height,drawn=0,drawDelay=250;width=.98*element.parent().innerWidth(),height=element.parent().innerHeight(),width<150&&(width=205),height<=width&&(height=width),height=width,$timeout(function(){element.parent().height()&&0===drawn&&(drawMe(width,height),drawn=1)},5e3+scope.delay*drawDelay),scope.rangestart=scope.rangestart||0;var plainTextFromHTML=function(text){return text?String(text).replace(/<[^>]+>/gm,""):""},drawMe=function(width,height){scope.rangestart<scope.rangeend?scope.current>scope.rangeend&&(scope.current=scope.rangeend):scope.current<scope.rangeend&&(scope.current=scope.rangeend);var w=width,h=height,ah=h/scope.ratio,margins={top:0,left:0,right:0,bottom:0,texmargin:15},dataset=[{name:"x",data:[{month:"x",count:scope.rangeend,start:50}]},{name:"y",data:[{month:"y",count:scope.current,start:0}]}];dataset.map(function(d){return d.name});dataset=dataset.map(function(d){return d.data.map(function(o,i){return{y:o.count,x:o.month,s:o.start}})}),stack=d3.layout.stack(),stack(dataset),dataset=dataset.map(function(group){return group.map(function(d){return console.log("dataset.map",d),{x:d.y,y:d.x,x0:d.y0,start:d.s}})});var svg=d3.select(element[0]).append("svg").attr("viewBox","0 0 "+w+" "+ah).attr("preserveAspectRatio","xMinYMin meet").append("g").attr("transform","translate("+margins.left+","+margins.top+")").attr("alt",plainTextFromHTML(scope.alttext));d3.max(dataset,function(group){return d3.max(group,function(d){return d.x+d.x0})});console.log("[scope.rangestart, width*.9]",[scope.rangestart,.9*width]);var xScale=d3.scale.linear().domain([scope.rangestart,scope.rangeend]).range([scope.rangestart,.9*width]),xScaleRev=d3.scale.linear().domain([scope.rangeend,scope.rangestart]).range([scope.rangestart,.9*width]),months=dataset[0].map(function(d){return d.y}),xAxis=(d3.scale.ordinal().domain(months).rangeRoundBands([0,height],.5),d3.svg.axis().scale(xScale).ticks(7).innerTickSize(-ah)),groups=(d3.svg.axis().scale(xScaleRev).ticks(7).innerTickSize(-ah),svg.selectAll("g").data(dataset).enter().append("g").attr("class",function(d,i){return"bg-"+scope.colors[i]}));groups.selectAll().data(function(d){return d}).enter().append("rect").attr("x",1.5*margins.texmargin).attr("y",2*margins.texmargin).attr("height",ah-2*margins.texmargin).attr("width",function(d){return xScale(d.x)}),groups.selectAll("rect");console.log("scope.rangeend = "+scope.rangeend+" - scope.target = "+scope.target,Math.abs(scope.rangeend-scope.target));var successBarWidth=3;scope.rangeend!=scope.target&&(successBarWidth=Math.abs(xScale(scope.target)-xScale(scope.rangeend))),Math.abs(xScale(scope.target)-xScale(.97*scope.target));var bar=svg.append("g");bar.append("rect").attr("width",successBarWidth).attr("height",ah).attr("x",xScale(scope.target)+1.5*margins.texmargin).attr("y",0).attr("id","MU MU ZIPO ZIPO").attr("class","bg-lillypad-0-fade-6"),svg.append("g").attr("class","axis color-white").call(xAxis),svg.selectAll(".axis line").attr("transform",function(d){return"translate("+1.5*margins.texmargin+","+(ah+1.75*margins.texmargin)+")"}),svg.selectAll(".axis text").attr("transform",function(d){return"translate("+1.5*margins.texmargin+","+margins.texmargin/2+")rotate(0)"})}}};return directiveDefinitionObject}),PARTICLE.directive("foo",function($timeout){return{restrict:"E",replace:!0,transclude:!0,scope:{typeclass:"=",message:"="},template:'<div class="{{typeclass}}"></div>',link:function(scope,element,attrs){}}}),PARTICLE.directive("vBlock",function(){return{templateUrl:"/directives/value_block.html",transclude:!0,scope:{lab:"=?",value:"=?",units:"=?",pack:"=?",assignto:"=?",unitcolor:"=?",bgcolor:"=?",labelwidth:"=?",valuewidth:"=?"},link:function(scope,element,attrs,ctrl,transclude){scope.controlClick=function(evt,obj){scope.isActive=!scope.isActive}}}}),PARTICLE.directive("invHeaderBlock",function(){return{templateUrl:"/directives/inv_header_block.html",transclude:!0,scope:{label:"=?",value:"=?",fade:"=?",lgsize:"=?",color:"=?",labelcolor:"=?"}}}),PARTICLE.directive("projectAlert",function(){return{templateUrl:"/directives/project_alert.html",transclude:!0,scope:{label:"=?",value:"=?",units:"=?",flag:"=?"}}}),PARTICLE.directive("uiPod",function(){return{template:"",transclude:!0,scope:{pack:"=",assignto:"=",ui:"="},link:function(scope,element,attrs,ctrl,transclude){scope[scope.assignto]=scope.pack,scope.controlClick=function(evt,obj){scope.isActive=!scope.isActive},transclude(scope.$new(),function(clone,scope){element.append(clone)})}}}),PARTICLE.directive("collection",function(){return{restrict:"E",replace:!0,scope:{collection:"=",requirements:"=",toggle:"&",myData:"&"},template:"<div class='row flex'><member ng-repeat='widget in collection' requirements='requirements' member='widget'></member></div>"}}),PARTICLE.directive("member",function($compile,$rootScope,$timeout){return{restrict:"E",replace:!0,scope:{member:"=",requirements:"="},templateUrl:"directives/item-block.html",link:function(scope,element,attrs){var collectionSt='<collection collection="member.widgets"></collection>';scope.$on("message",function(e,msg){msg[0]==scope.member.id_class&&(scope.member.toggle=!scope.member.toggle),msg[1]==scope.member.group_class&&msg[0]!=scope.member.id_class&&(scope.member.toggle=0)}),angular.isArray(scope.member.widgets)&&$compile(collectionSt)(scope,function(cloned,scope){element.append(cloned)})},controller:function($scope){var initial_state=$scope.member.toggle;$scope.member.toggle=1,$timeout(function(){$scope.member.toggle=initial_state},100),$scope.f=function(id){this.member.disable_hide_show!==!0&&(this.member.hides?$rootScope.$broadcast("message",[id,this.member.hides]):$rootScope.$broadcast("message",[id,"LACKAHIDES"]))}}}}),PARTICLE.directive("contentBlock",function($parse,$window,$timeout,dataIo,CONFIG,$sce){var directiveDefinitionObject={restrict:"EA",template:'<ng-include src="getTemplateUrl()"/>',scope:{index:"=",obj:"=",type:"="},link:function(scope,element,attrs){scope.loaded=null,scope.error=null,scope.CONFIG=CONFIG;var singleType=scope.type,idlocation="_id";idlocation=scope.obj._id?"_id":"$oid",scope.getTemplateUrl=function(){return"s"==singleType.charAt(singleType.length-1)&&(singleType=singleType.substr(0,singleType.length-1)),scope.singleType=singleType,CONFIG.viewPath+singleType+".html"},dataIo.getFile({file:CONFIG.contentPath+scope.type+"/"+scope.obj[idlocation]+CONFIG.contentFileSuffix}).then(function(_data){scope.content=dataIo.parseContent(_data.data[Object.keys(_data.data)[0]]),scope.loaded=!0})["catch"](function(_data){console.log("Error in DIRECTIVE:contentBlock"),scope.error=_data})}};return directiveDefinitionObject}),PARTICLE.directive("donutChart",function($parse,$window,$timeout){var directiveDefinitionObject={restrict:"E",replace:!1,scope:{data:"=chartData",whoamiin:"=whoamiin",member:"=member"},link:function(scope,element,attrs){var width,height,drawn=0;width=.98*element.parent().innerWidth(),height=element.parent().innerHeight(),width<150&&(width=205),height<=width&&(height=width),height=width;var drawMe=(scope.$watch(function(){return element.parent().parent().parent().is(":visible")},function(){$timeout(function(){element.parent().height()&&0===drawn&&(drawMe(),drawn=1)},0)}),function(){var dataset=[100,90,80,70,60,50],w=(Math.min(width,height)/2,width),h=height,tw=w/2*(w/h),th=h/2,svg=d3.select(element[0]).append("svg").attr("viewBox","0 0 "+2*tw+" "+2*th).attr("preserveAspectRatio","xMinYMin meet").append("g").attr("transform","translate("+tw+","+th+")"),color=d3.scale.ordinal().range(["#009DD9","#FF8300","#B21DAC","#D70036","#707276","#000000"]),pie=d3.layout.pie().sort(null),arc=d3.svg.arc().innerRadius(width/2-width/4).outerRadius(width/2);svg.selectAll("path").data(pie(dataset)).enter().append("path").attr("fill",function(d,i){return color(i)}).attr("d",arc).attr("class",function(d,i){return"fill-color-"+i}).each(function(d){this._current=d})})}};return directiveDefinitionObject}),PARTICLE.directive("fillChart",function($parse,$window,$timeout){var directiveDefinitionObject={restrict:"E",replace:!1,scope:{data:"=chartData",whoamiin:"=whoamiin",member:"=member",elementid:"=elementid"},link:function(scope,element,attrs){var width,height,drawn=0;width=.98*element.parent().innerWidth(),height=element.parent().innerHeight(),width<150&&(width=205),height<=width&&(height=width),height=width;var drawMe=(scope.$watch(function(){return element.parent().parent().parent().is(":visible")},function(){$timeout(function(){element.parent().height()&&0===drawn&&(drawMe(),drawn=1)},0)}),function(){var w=width,h=height,tw=w/2*(w/h),th=h/2,el=scope.elementid;d3.select(element[0]).append("svg").attr("viewBox","0 0 "+2.05*tw+" "+2.05*th).attr("preserveAspectRatio","xMinYMin meet").attr("id",el);loadLiquidFillGauge(el,70),liquidFillGaugeDefaultSettings()})}};return directiveDefinitionObject}),PARTICLE.directive("itemBlock",function($compile,$rootScope,$timeout){return{restrict:"E",replace:!0,scope:{member:"="},templateUrl:"/directives/iblock.html",link:function(scope,element,attrs){scope.$watch(attrs.member,function(){void 0!==scope.member&&console.log("WATCH Fired",scope.member)});var collectionSt='<collection collection="member.widgets"></collection>';scope.$on("message",function(e,msg){msg[0]==scope.member.id_class&&(scope.member.toggle=!scope.member.toggle),msg[1]==scope.member.group_class&&msg[0]!=scope.member.id_class&&(scope.member.toggle=0)}),scope.member&&angular.isArray(scope.member.widgets)&&$compile(collectionSt)(scope,function(cloned,scope){element.append(cloned)})},controller:function($scope){if(void 0!==$scope.member){var initial_state=$scope.member.toggle;$scope.member.toggle=1,$timeout(function(){$scope.member.toggle=initial_state},100)}$scope.f=function(id){this.member.disable_hide_show!==!0&&(this.member.hides?$rootScope.$broadcast("message",[id,this.member.hides]):$rootScope.$broadcast("message",[id,"LACKAHIDES"]))}}}}),PARTICLE.directive("multipleTimeline",function($parse,$window,$timeout){var directiveDefinitionObject={restrict:"E",replace:!1,scope:{config:"=",datasets:"=",colors:"=",max:"=",min:"=",mockup:"=",index:"="},link:function(scope,element,attrs){var drawn=0;$timeout(function(){element.parent().height()&&0===drawn&&(drawMe(scope.index),drawn=1)},1);var drawMe=function(index){var width,height,dataset,chart,config={chartInset:0,hasSuccessIndicator:!0,hasBandIndicator:!1,margin:{top:20,right:80,bottom:40,left:90},barWidth:10,widthPercentSize:1.1,needLength:1,colors:{primary_fill:"color-pewter",color_2:"boldorange-0-fade-1",success:"color-bluepuddy-0-fade-5",needle:"color-pewter-0-fade-0",bg:"color-white-6-fade-8",legend:"color-bluepuddy-8-fade-0"},max:100,min:0};void 0!==scope.config&&Object.keys(scope.config).forEach(function(key,index){config[key]=scope.config[key]}),el=d3.select(element[0]),width=element[0].parentElement.clientWidth,height=275,dataset=scope.datasets,dataset.forEach(function(d){d.date=new Date(d.date)});var color=d3.scale.category10();color.domain(d3.keys(dataset[0]).filter(function(key){return"date"!==key}));var xScale=d3.time.scale().domain([new Date(2015,5,31),new Date(2016,7,1)]).range([0+config.margin.left,width-config.margin.right]),fields=["replan","correction","rebaseline"],yScale=d3.scale.ordinal().domain(fields).rangePoints([height-config.margin.bottom,config.margin.top]);dataset.length;chart=el.append("svg").attr("viewBox","0 0 "+width+" "+height).attr("preserveAspectRatio","xMinYMin slice").attr("height",height).attr("width",width);var xAxis=d3.svg.axis().scale(xScale).orient("bottom").innerTickSize(-height+config.margin.top+config.margin.bottom).outerTickSize(0).tickPadding(20),yAxis=d3.svg.axis().scale(yScale).orient("left").ticks(fields.length).innerTickSize(-width+config.margin.left+config.margin.right).outerTickSize(0).tickPadding(20),point=(chart.append("g").attr("id","xaxis").attr("class","color-white-0").attr("transform","translate(0, "+(height-config.margin.bottom)+")").call(xAxis).selectAll("text").style("text-anchor","middle").attr("dy","10px").style("font-weight",function(d){if(0===d.getMonth())return"bold"}),chart.append("g").attr("id","yaxis").attr("class","color-white-0").attr("transform","translate("+config.margin.left+",0)").call(yAxis).selectAll("text").style("text-anchor","end").text(function(d){return d.charAt(0).toUpperCase()+d.slice(1)}),chart.append("g").attr("class","line-point"));point.selectAll("circle").data(dataset).enter().append("circle").attr("cx",function(d){return xScale(d.date)}).attr("cy",function(d){return yScale(d.type)}).attr("r",10).attr("class","color-white-0-fade-5").style("stroke",function(d){return color(d.type)}).style("stroke-width","4px")}}};return directiveDefinitionObject}),PARTICLE.directive("needleChart",function($parse,$window,$timeout){var directiveDefinitionObject={restrict:"E",replace:!1,scope:{config:"=",datasets:"=",colors:"=",percentcomplete:"=",successpercent:"=",max:"=",min:"=",mockup:"=",alttext:"="},link:function(scope,element,attrs){var drawn=0;$timeout(function(){element.parent().height()&&0===drawn&&(drawMe(),drawn=1)},100);var plainTextFromHTML=function(text){return text?String(text).replace(/<[^>]+>/gm,""):""},drawMe=function(){function centerTranslation(){return"translate("+radius/2+","+radius/2+")"}var chart,degToRad,repaintGauge,success_per,height,padRad,percToDeg,percToRad,percent,radius,svg,width;padRad=.025;var config={chartInset:20,hasSuccessIndicator:!0,hasBandIndicator:!1,margin:{top:0,right:20,bottom:0,left:20},barWidth:100,widthPercentSize:1.1,successIndicatorDegWidth:0,startAngle:-110,endAngle:110,needLength:1,colors:{primary_fill:"color-pewter",color_2:"boldorange-0-fade-1",success:"color-bluepuddy-0-fade-5",needle:"color-pewter-0-fade-0",bg:"color-white-6-fade-8",legend:"color-bluepuddy-8-fade-0"},labelFormat:d3.format(",g"),max:100,min:0,units:"%"};void 0!==scope.config&&Object.keys(scope.config).forEach(function(key,index){config[key]=scope.config[key]}),percToDeg=function(perc){return 360-(totalAngle*perc+config.startAngle)},percToRad=function(perc){return degToRad(percToDeg(perc))},degToRad=function(deg){return deg*Math.PI/180},el=d3.select(element[0]),width=element.innerWidth(),radius=.5*width,height=radius+Math.sin(degToRad(config.endAngle-90))*radius,console.log("config.widthPercentSize",config.widthPercentSize),svg=el.append("svg").attr("viewBox","0 0 "+width*config.widthPercentSize+" "+height*config.widthPercentSize).attr("preserveAspectRatio","xMinYMin meet").append("g").attr("transform","translate("+config.widthPercentSize*width/2+", "+config.widthPercentSize*(width/2)+")").attr("width",width).attr("height",height).attr("alt",plainTextFromHTML(scope.alttext)),chart=svg.append("g"),chart.append("path").attr("class","arc "+config.colors.primary_fill+" primary_band"),chart.append("path").attr("class","arc "+config.colors.success+" success_band"),chart.append("path").attr("class","arc "+config.colors.bg+" bg_band");var scale=(centerTranslation(),d3.scale.linear().range([0,1]).domain([config.min,config.max])),range=config.endAngle-config.startAngle,ticks=scale.ticks(9),lg=svg.append("g").attr("class","color-white").attr("transform","translate(0,0)");lg.selectAll("text").data(ticks).enter().append("text").attr("transform",function(d){var ratio=scale(d),newAngle=degToRad(config.startAngle+ratio*range);newAngle=degToRad(180-(range*ratio+config.startAngle));var turnAngle=range*ratio;console.log(turnAngle,",turnAngle");var xpos=Math.sin(newAngle)*(radius+config.chartInset),ypos=Math.cos(newAngle)*(radius+config.chartInset);return console.log("xpos,ypos",xpos,ypos),console.log("radius",radius),"rotate(0) translate("+(xpos-10)+","+(ypos+5)+")"}).text(config.labelFormat);var arc_Background=d3.svg.arc().outerRadius(radius-config.chartInset).innerRadius(radius-config.chartInset-config.barWidth),arc_Progress=d3.svg.arc().outerRadius(radius-config.chartInset).innerRadius(radius-config.chartInset-config.barWidth),arc_Success=d3.svg.arc().outerRadius(radius-config.chartInset).innerRadius(0);if(100!=config.max||0!==config.min){var gaugeRange;config.max>config.min?(gaugeRange=Math.abs(config.max-config.min),success_per=(scope.successpercent-config.min)/gaugeRange):(gaugeRange=Math.abs(config.min-config.max),success_per=(config.min-scope.successpercent)/gaugeRange),percent=scope.percentcomplete/100}else percent=scope.percentcomplete/100,success_per=100==scope.successpercent?.99:scope.successpercent/100,
percent=scope.percentcomplete/100;percent>1&&(percent=1);var successAngleEnd,startAngleRad=degToRad(config.startAngle),endAngleRad=degToRad(config.endAngle),totalAngle=config.endAngle-config.startAngle,perAngle=totalAngle*percent+config.startAngle,successAngle=totalAngle*success_per+config.startAngle;successAngleEnd=void 0!==config.successIndicatorDegWidth&&config.successIndicatorDegWidth>0?totalAngle*success_per+config.startAngle+config.successIndicatorDegWidth:config.endAngle,arc_Background.startAngle(degToRad(config.startAngle)).endAngle(endAngleRad),chart.select(".bg_band").attr("d",arc_Background),config.hasSuccessIndicator&&(arc_Success.startAngle(degToRad(successAngle)).endAngle(degToRad(successAngleEnd)),chart.select(".success_band").attr("d",arc_Success)),config.hasBandIndicator&&(arc_Progress.startAngle(startAngleRad).endAngle(degToRad(perAngle)),chart.select(".primary_band").attr("d",arc_Progress)),repaintGauge=function(perc){};var needle,Needle=function(){function Needle(el){this.el=el,this.len=radius*config.needLength-.5*config.barWidth,this.radius=.2*this.len}var recalcPointerPos=function(perc){var centerX,centerY,leftX,leftY,rightX,rightY,thetaRad,topX,topY;return thetaRad=degToRad(360-(totalAngle*perc+config.startAngle)),centerX=0,centerY=0,topX=centerX-this.len*Math.sin(thetaRad),topY=centerY-this.len*Math.cos(thetaRad),leftX=centerX-this.radius*Math.sin(thetaRad-Math.PI/2),leftY=centerY-this.radius*Math.cos(thetaRad-Math.PI/2),rightX=centerX-this.radius*Math.sin(thetaRad+Math.PI/2),rightY=centerY-this.radius*Math.cos(thetaRad+Math.PI/2),"M "+leftX+" "+leftY+" L "+topX+" "+topY+" L "+rightX+" "+rightY};return Needle.prototype.render=function(){return this.el.append("circle").attr("class","needle-center "+config.colors.needle).attr("cx",0).attr("cy",0).attr("r",this.radius),this.el.append("path").attr("class","needle "+config.colors.needle).attr("d",recalcPointerPos.call(this,0))},Needle.prototype.moveTo=function(perc){var self,oldValue=this.perc||0;this.perc=perc,self=this,this.el.transition().delay(100).ease("quad").duration(500).select(".needle").tween("reset-progress",function(){return function(percentOfPercent){var progress=(1-percentOfPercent)*oldValue;return repaintGauge(progress),d3.select(this).attr("d",recalcPointerPos.call(self,progress))}}),this.el.transition().delay(300).ease("bounce").duration(1500).select(".needle").tween("progress",function(){return function(percentOfPercent){var progress=percentOfPercent*perc;return repaintGauge(progress),d3.select(this).attr("d",recalcPointerPos.call(self,progress))}})},Needle}();needle=new Needle(chart),needle.render(),console.log("Org Percent",percent),needle.moveTo(percent)}}};return directiveDefinitionObject}),PARTICLE.directive("pieChartLabel",function($parse,$window,$timeout){var directiveDefinitionObject={restrict:"E",replace:!1,scope:{data:"=chartData",whoamiin:"=whoamiin",member:"=member"},link:function(scope,element,attrs){var width,height,drawn=0;width=.98*element.parent().innerWidth(),height=element.parent().innerHeight(),width<150&&(width=205),height<=width&&(height=width),height=width;var drawMe=(scope.$watch(function(){return element.parent().parent().parent().is(":visible")},function(){$timeout(function(){element.parent().height()&&0===drawn&&(drawMe(),drawn=1)},0)}),function(){function randomData(){var labels=color.domain();return labels.map(function(label){return{label:label,value:Math.random()}})}function change(data){function midAngle(d){return d.startAngle+(d.endAngle-d.startAngle)/2}var slice=svg.select(".slices").selectAll("path.slice").data(pie(data),key);slice.enter().insert("path").attr("class",function(d,i){return"slice fill-color-"+i}),slice.transition().duration(1e3).attrTween("d",function(d){this._current=this._current||d;var interpolate=d3.interpolate(this._current,d);return this._current=interpolate(0),function(t){return arc(interpolate(t))}}),slice.exit().remove();var text=svg.select(".labels").selectAll("text").data(pie(data),key);text.enter().append("text").attr("dy",".35em").text(function(d){return d.data.label}),text.transition().duration(1e3).attrTween("transform",function(d){this._current=this._current||d;var interpolate=d3.interpolate(this._current,d);return this._current=interpolate(0),function(t){var d2=interpolate(t),pos=outerArc.centroid(d2);return pos[0]=radius*(midAngle(d2)<Math.PI?1:-1),"translate("+pos+")"}}).styleTween("text-anchor",function(d){this._current=this._current||d;var interpolate=d3.interpolate(this._current,d);return this._current=interpolate(0),function(t){var d2=interpolate(t);return midAngle(d2)<Math.PI?"start":"end"}}),text.exit().remove();var polyline=svg.select(".lines").selectAll("polyline").data(pie(data),key);polyline.enter().append("polyline"),polyline.transition().duration(1e3).attrTween("points",function(d){this._current=this._current||d;var interpolate=d3.interpolate(this._current,d);return this._current=interpolate(0),function(t){var d2=interpolate(t),pos=outerArc.centroid(d2);return pos[0]=.95*radius*(midAngle(d2)<Math.PI?1:-1),[arc.centroid(d2),outerArc.centroid(d2),pos]}}),polyline.exit().remove()}var w=width,h=height,th=h/2,radius=Math.min(width,height)/2,svg=d3.select(element[0]).append("svg").attr("viewBox","0 0 "+w+" "+h).attr("preserveAspectRatio","xMinYMin meet").append("g");svg.append("g").attr("class","slices"),svg.append("g").attr("class","labels"),svg.append("g").attr("class","lines");var pie=d3.layout.pie().sort(null).value(function(d){return d.value}),arc=d3.svg.arc().outerRadius(.8*radius).innerRadius(.4*radius),outerArc=d3.svg.arc().innerRadius(.9*radius).outerRadius(.9*radius);svg.attr("transform","translate("+w+","+th+")");var key=function(d){return d.data.label},color=d3.scale.ordinal().domain(["Lorem ipsum","dolor sit","amet","consectetur","adipisicing","elit","sed","do","eiusmod","tempor","incididunt"]).range(["#98abc5","#8a89a6","#7b6888","#6b486b","#a05d56","#d0743c","#ff8c00"]);change(randomData()),d3.select(".randomize").on("click",function(){change(randomData())})})}};return directiveDefinitionObject}),PARTICLE.directive("pieChart",function($parse,$window,$timeout){var directiveDefinitionObject={restrict:"E",replace:!1,scope:{data:"=chartData",whoamiin:"=whoamiin",member:"=member"},link:function(scope,element,attrs){var width,height,drawn=0;width=.98*element.parent().innerWidth(),height=element.parent().innerHeight(),width<150&&(width=205),height<=width&&(height=width),height=width;var drawMe=(scope.$watch(function(){return element.parent().parent().parent().is(":visible")},function(){$timeout(function(){element.parent().height()&&0===drawn&&(drawMe(),drawn=1)},0)}),function(){var dataset=[100,90,80,70,60,50],w=(Math.min(width,height)/2,width),h=height,tw=w/2*(w/h),th=h/2,svg=d3.select(element[0]).append("svg").attr("viewBox","0 0 "+2*tw+" "+2*th).attr("preserveAspectRatio","xMinYMin meet").append("g").attr("transform","translate("+tw+","+th+")"),color=d3.scale.ordinal().range(["#009DD9","#FF8300","#B21DAC","#D70036","#707276","#000000"]),pie=d3.layout.pie().sort(null),arc=d3.svg.arc().innerRadius(width/2-width/4).outerRadius(width/2);svg.selectAll("path").data(pie(dataset)).enter().append("path").attr("fill",function(d,i){return color(i)}).attr("d",arc).attr("class",function(d,i){return"fill-color-"+i}).each(function(d){this._current=d})})}};return directiveDefinitionObject}),PARTICLE.directive("progressMeter",function($parse,$window,$timeout){var directiveDefinitionObject={restrict:"E",replace:!1,scope:{colors:"=",datasets:"="},link:function(scope,element,attrs){var width,height,drawn=0;width=.98*element.parent().innerWidth(),height=element.parent().innerHeight(),width<150&&(width=205),height<=width&&(height=width),height=width;var config=(scope.$watch(function(){return element.parent().parent().parent().is(":visible")},function(){$timeout(function(){element.parent().height()&&0===drawn&&(drawMe(),drawn=1)},0)}),{chartInset:0,hasSuccessIndicator:!0,hasBandIndicator:!1,margin:{top:0,right:0,bottom:0,left:0},barWidth:.2,successIndicatorDegWidth:0,startAngle:-110,endAngle:110,needLength:1,colors:{primary_fill:"color-pewter",color_2:"boldorange-0-fade-1",success:"color-bluepuddy-0-fade-5",needle:"color-bluepuddy-0-fade-0",bg:"color-white-6-fade-8",legend:"color-bluepuddy-8-fade-0"}}),drawMe=function(){var i,twoPi=2*Math.PI,bits=({progress:Math.floor(100*Math.random()),total:100},{progress:Math.floor(100*Math.random()),total:100},3),dataSets=[];.25*(width-2*dataSets.length)/dataSets.length;for(i=0;i<bits;i++)dataSets.push({progress:Math.floor(100*Math.random()),total:100});var arc=d3.svg.arc().innerRadius(.25*width-width/(2*dataSets.length)/2).outerRadius(.5*width).startAngle(0),w=(d3.svg.arc().innerRadius(.29*width).outerRadius(.395*width).startAngle(0),width),h=height,tw=w/2*(w/h),th=h/2,svg=d3.select(element[0]).append("svg").attr("viewBox","0 0 "+2*tw+" "+2*th).attr("preserveAspectRatio","xMinYMin slice").append("g").attr("transform","translate("+tw+","+th+")"),meter=svg.append("g").attr("class","info"),foreground=(meter.append("path").datum({endAngle:twoPi}).attr("class",config.colors.bg).attr("d",arc),meter.append("text").attr("text-anchor","middle").attr("dy",".35em").attr("font-size","4em").attr("font-weight","300").text(100*scope.datasets[0]+"%"),meter.append("text").attr("text-anchor","middle").attr("dy","3em").attr("font-size","1em").attr("font-weight","300").text("Complete"),meter.append("path").datum({endAngle:0}).attr("class","bg-"+(scope.datasets[0]>.5?config.colors.success:config.colors.needle)).attr("d",arc));foreground.transition().duration(1e3).ease("linear").attrTween("d",function(d){var interpolate=d3.interpolate(d.endAngle,twoPi*scope.datasets[0]);return function(t){return d.endAngle=interpolate(t),arc(d)}})}}};return directiveDefinitionObject}),PARTICLE.directive("sectionHeader",function(){return{restrict:"E",scope:{item:"="},templateUrl:"/directives/sectionheader.html"}}),PARTICLE.directive("stackedBarchart",function($parse,$window,$timeout){var directiveDefinitionObject={restrict:"E",replace:!1,scope:{config:"=",datasets:"=",colors:"=",percentcomplete:"=",successpercent:"=",max:"=",min:"=",mockup:"=",index:"="},link:function(scope,element,attrs){var drawn=0;$timeout(function(){0===drawn&&(drawMe(),drawn=1)},50);var drawMe=function(){var width,height,dataset,layers,spending,x,y,z,chart,xAxis,yAxis,layer,config={chartInset:0,hasSuccessIndicator:!0,hasBandIndicator:!1,margin:{top:20,right:20,bottom:30,left:50},barWidth:10,widthPercentSize:1.1,needLength:1,colors:{primary_fill:"color-pewter",color_2:"boldorange-0-fade-1",success:"color-bluepuddy-0-fade-5",needle:"color-pewter-0-fade-0",bg:"color-white-6-fade-8",legend:"color-bluepuddy-8-fade-0"},max:100,min:0};void 0!==scope.config&&Object.keys(scope.config).forEach(function(key,index){config[key]=scope.config[key]}),el=d3.select(element[0]),width=element[0].parentElement.clientWidth,height=200,dataset=scope.datasets,spending=["DME","OM"],layers=d3.layout.stack()(spending.map(function(c){return dataset.map(function(d){return{x:d.year,y:d[c]}})})),x=d3.scale.ordinal().rangeRoundBands([config.margin.left,width-config.margin.right],.2).domain(layers[0].map(function(d){return d.x})),y=d3.scale.linear().rangeRound([height-config.margin.bottom,config.margin.top]).domain([0,d3.max(layers[layers.length-1],function(d){return d.y0+d.y})]).nice(),z=d3.scale.category10(),chart=d3.select(element[0]).append("svg").attr("viewBox","0 0 "+width+" "+height).attr("preserveAspectRatio","xMinYMin slice").append("g").attr("height",height).attr("width",width),xAxis=d3.svg.axis().scale(x).orient("bottom").outerTickSize(0),yAxis=d3.svg.axis().scale(y).orient("left").innerTickSize(-width+config.margin.left+config.margin.right).outerTickSize(0).ticks(5).tickPadding(10),layer=chart.selectAll(".layer").data(layers).enter().append("g").attr("class","layer").style("fill",function(d,i){return z(i)}),layer.selectAll("rect").data(function(d){return d}).enter().append("rect").attr("x",function(d){return x(d.x)}).attr("y",function(d){return y(d.y+d.y0)}).attr("height",function(d){return y(d.y0)-y(d.y+d.y0)}).attr("width",x.rangeBand()-1);var y_axis=(chart.append("g").attr("class","axis axis--x").attr("transform","translate(0,"+(height-config.margin.bottom)+")").attr("class","color-white-0").call(xAxis),chart.append("g").attr("class","axis axis--y").attr("transform","translate("+config.margin.left+",0)").attr("class","color-white-0").call(yAxis));y_axis.selectAll("text").text(function(d){return"$ "+d+"M"})}}};return directiveDefinitionObject}),PARTICLE.directive("timeseriesBarplot",function($parse,$window,$timeout){var directiveDefinitionObject={restrict:"E",replace:!1,scope:{config:"=",datasets:"=",colors:"=",percentcomplete:"=",successpercent:"=",max:"=",min:"=",mockup:"=",index:"="},link:function(scope,element,attrs){var drawn=0;$timeout(function(){0===drawn&&(drawMe(),drawn=1)},1);var drawMe=function(){var width,height,dataset,layers,config={chartInset:0,hasSuccessIndicator:!0,hasBandIndicator:!1,margin:{top:20,right:20,bottom:60,left:60},barWidth:20,widthPercentSize:1.1,needLength:1,colors:{primary_fill:"color-pewter",color_2:"boldorange-0-fade-1",success:"color-bluepuddy-0-fade-5",needle:"color-pewter-0-fade-0",bg:"color-white-6-fade-8",legend:"color-bluepuddy-8-fade-0"},max:100,min:0,endDate:new Date,startDate:new Date-31536e6};console.log("timeseries dates",config.endDate,config.startDate),void 0!==scope.config&&Object.keys(scope.config).forEach(function(key,index){config[key]=scope.config[key]}),el=d3.select(element[0]),width=element[0].parentElement.clientWidth,height=275,dataset=scope.datasets,readDate=d3.time.format("%m/%d/%y").parse,dataset.forEach(function(d){d.date=new Date(d.date)});for(var startdate=readDate("06/30/15"),enddate=readDate("06/30/16"),sub=[],i=0;i<dataset.length;i++)dataset[i].date>=startdate&dataset[i].date<=enddate&&sub.push(d3.values(dataset)[i]);layers=sub.map(function(d){return{x:d.date,y:+d.rating,y0:0}}),xScale=d3.time.scale().domain([startdate,enddate]).range([0+config.margin.left,width-config.margin.right]),yScale=d3.scale.linear().domain([0,5]).range([height-config.margin.bottom,config.margin.top]).nice();var yticks=5,xticks=12,ytickdist=(height-config.margin.bottom-config.margin.top)/yticks,xtickdist=(width-config.margin.right-config.margin.left)/xticks,chart=el.append("svg").attr("viewBox","0 0 "+width+" "+height).attr("preserveAspectRatio","xMinYMin slice").append("g").attr("height",height).attr("width",width),xAxis=d3.svg.axis().scale(xScale).orient("bottom").outerTickSize(0),yAxis=d3.svg.axis().scale(yScale).orient("left").ticks(yticks).innerTickSize(-width+config.margin.left+config.margin.right).outerTickSize(0).tickPadding(10),x_axis=chart.append("g").attr("class","axis x").attr("transform","translate(0, "+(height-config.margin.bottom)+")").call(xAxis).selectAll("text").attr("class","color-white").style("text-anchor",function(d){return 0!==d.getMonth()?"middle":"start"}).attr("dy","10px").attr("transform",function(d){if(0!==d.getMonth())return"translate("+xtickdist/2+", 0)"}).style("font-weight",function(d){if(0===d.getMonth())return"bold"}),y_axis=chart.append("g").attr("class","axis y").attr("transform","translate("+config.margin.left+",0)").call(yAxis).selectAll("text").attr("class","color-white").attr("transform","translate(0, "+ytickdist/2+")").style("text-anchor","middle").text(function(d){return"0"==d?null:d});(height-config.margin.top-config.margin.bottom)/yticks;y_axis.append("g").append("text").attr("x",(-height+config.margin.bottom+config.margin.top)/2-config.margin.top).attr("y",-config.margin.left/2).attr("transform","rotate(-90)").attr("text-anchor","middle").style("font-weight","bold").attr("class","color-white").text("Rating"),x_axis.append("g").append("text").attr("y",50).attr("x",.5*width).attr("text-anchor","middle").style("font-weight","bold").attr("class","color-white").text("Submission Date");chart.selectAll("rect").data(layers).enter().append("rect").attr("x",function(d){return xScale(d.x)}).attr("y",function(d){return yScale(d.y0+d.y)}).attr("width",config.barWidth).attr("height",function(d){return yScale(d.y0)-yScale(d.y+d.y0)}).attr("date",function(d){return d.x}).attr("rating",function(d){return d.y}).attr("class",function(d){return 3==d.y?"bg-color-offgold-0-fade-4":"1"==d.y|"2"==d.y?"bg-color-boldred-0-fade-4":"4"==d.y|"5"==d.y?"bg-color-lillypad-0-fade-4":"#000"})}}};return directiveDefinitionObject}),PARTICLE.directive("trendChart",function($parse,$window,$timeout){var directiveDefinitionObject={restrict:"E",replace:!1,scope:{config:"=",datasets:"=",colors:"=",percentcomplete:"=",successpercent:"=",max:"=",min:"=",mockup:"=",index:"="},link:function(scope,element,attrs){var drawn=0;$timeout(function(){element.parent().height()&&0===drawn&&(drawMe(scope.index),drawn=1)},5);var drawMe=function(indexval){var width,height,dataset,config={chartInset:0,hasSuccessIndicator:!0,hasBandIndicator:!1,margin:{top:10,right:40,bottom:60,left:70},barWidth:10,widthPercentSize:1.1,needLength:1,colors:{primary_fill:"color-pewter",color_2:"boldorange-0-fade-9",success:"color-bluepuddy-0-fade-5",needle:"color-pewter-0-fade-0",bg:"color-white-6-fade-8",legend:"color-bluepuddy-8-fade-0"},max:100,min:0};void 0!==scope.config&&Object.keys(scope.config).forEach(function(key,index){config[key]=scope.config[key]}),el=d3.select(element[0]),width=element[0].parentElement.clientWidth,height=275,dataset=scope.datasets,dataset.forEach(function(d){d.date=new Date(d.date)});var color=d3.scale.category10();color.domain(d3.keys(dataset[0]).filter(function(key){return"date"!==key&"label"!==key}));var metrics=color.domain().map(function(name){return{name:name,values:dataset.map(function(d){return{date:d.date,value:+d[name]}})}}),xTickValues=[];metrics[0].values.forEach(function(d){xTickValues.push(d.date)});var date_format=d3.time.format("%b %y");xScale=d3.time.scale().domain(d3.extent(dataset,function(d){return d.date})).range([0+config.margin.left,width-config.margin.right]),yScale=d3.scale.linear().domain([0,100]).range([height-config.margin.bottom,config.margin.top]);var yticks=5,chart=(dataset.length,d3.select(element[0]).append("svg").attr("viewBox","0 0 "+width+" "+height).attr("preserveAspectRatio","xMinYMin slice").append("g").attr("height",height).attr("width",width)),xAxis=d3.svg.axis().scale(xScale).orient("bottom").innerTickSize(-height+config.margin.top+config.margin.bottom).outerTickSize(0).tickPadding(10).tickValues(xTickValues).tickFormat(date_format),yAxis=d3.svg.axis().scale(yScale).orient("left").ticks(yticks).innerTickSize(-width+config.margin.left+config.margin.right).outerTickSize(0).tickPadding(5);chart.append("g").attr("id","xaxis").attr("class","color-white").attr("transform","translate(0, "+(height-config.margin.bottom)+")").call(xAxis).selectAll("text").style("text-anchor","middle").attr("dy","10px").style("font-weight",function(d){if(0===d.getMonth())return"bold"}),chart.append("g").attr("id","yaxis"+indexval).attr("class","color-white").attr("transform","translate("+config.margin.left+",0)").call(yAxis).selectAll("text").style("text-anchor","end").text(function(d){return d+"%"});d3.select("#yaxis"+indexval).append("text").attr("x",(-height+config.margin.bottom+config.margin.top)/2-config.margin.top).attr("y",-config.margin.left/1.5).attr("transform","rotate(-90)").attr("text-anchor","middle").style("font-weight","bold").text("Performance"),d3.select("#xaxis").append("text").attr("y",40).attr("x",.5*width).attr("text-anchor","middle").text("Snapshot Date");var line=d3.svg.line().interpolate("linear").x(function(d){return xScale(d.date)}).y(function(d){return yScale(d.value)}),metric=chart.selectAll(".metric").data(metrics).enter().append("g").attr("class","metric").attr("value",function(d){return d.value});metric.append("path").attr("class","line").attr("d",function(d){return line(d.values)}).style("stroke",function(d){return color(d.name)}).style("stroke-width","8px").style("fill","none");var point=metric.append("g").attr("class","line-point");point.selectAll("circle").data(function(d){return d.values}).enter().append("circle").attr("cx",function(d){return xScale(d.date)}).attr("cy",function(d){return yScale(d.value)}).attr("r",8).attr("class","color-white").style("stroke-width","1px").style("stroke",function(d){return color(this.parentNode.__data__.name)})}}};return directiveDefinitionObject}),PARTICLE.directive("usMap",function($parse,$window,$timeout){var directiveDefinitionObject={restrict:"E",replace:!1,scope:{data:"=chartData",whoamiin:"=whoamiin",member:"=member"},link:function(scope,element,attrs){var width,height,drawn=0;width=.9*element.parent().innerWidth(),height=.5*element.parent().innerHeight(),width<150&&(width=205),height<=width&&(height=width),height=500,console.log("progressMeter",width,height);var drawMe=(scope.$watch(function(){return element.parent().parent().parent().is(":visible")},function(){$timeout(function(){element.parent().height()&&0===drawn&&(drawMe(),drawn=1)},0)}),function(){var projection=d3.geo.albersUsa().translate([width/2,height/2]).scale([1100]),path=d3.geo.path().projection(projection),color=d3.scale.quantize().range(["#8AB28C","rgba(97, 65, 82,.5)","#666b95","rgb(49,163,84)","rgb(0,109,44)"]),svg=d3.select(element[0]).append("svg").attr("width",width).attr("height",height);d3.csv("csv/us-ag-productivity-2004.csv",function(data){color.domain([d3.min(data,function(d){return d.value}),d3.max(data,function(d){return d.value})]),d3.json("json/us-states.json",function(json){for(var i=0;i<data.length;i++)for(var dataState=data[i].state,dataValue=parseFloat(data[i].value),j=0;j<json.features.length;j++){var jsonState=json.features[j].properties.name;if(dataState==jsonState){json.features[j].properties.value=dataValue;break}}svg.selectAll("path").data(json.features).enter().append("path").attr("d",path).style("fill",function(d){var value=d.properties.value;return value?color(value):"#ccc"})})})})}};return directiveDefinitionObject}),PARTICLE.filter("applyFilter",["$filter",function($filter){return function(value,filters){if(filters){var params,parts=filters.split(":"),filterName=parts[0];parts[1]&&(params=parts[1].split(":"));var filterFn=$filter(filterName);return filterFn.apply(filterFn,[value].concat(params))}return value}}]),PARTICLE.filter("capitalize",function(){return function(input,all){var reg=all?/([^\W_]+[^\s-]*) */g:/([^\W_]+[^\s-]*)/;return input?input.replace(reg,function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase()}):""}}),PARTICLE.filter("percent",function(){return function(value,param1){return value.toFixed(param1)+"%"}}),PARTICLE.filter("significantDigits",["$filter",function($filter){return function(input,places){if(isNaN(input))return input;var digits=Math.min(input.toString().length,places);return Number(input).toPrecision(digits)}}]),PARTICLE.filter("titlecase",function(){return function(input){var smallWords=/^(a|an|and|as|at|but|by|en|for|if|in|nor|of|on|or|per|the|to|vs?\.?|via)$/i;return input=input.toLowerCase(),input.replace(/[A-Za-z0-9\u00C0-\u00FF]+[^\s-]*/g,function(match,index,title){return index>0&&index+match.length!==title.length&&match.search(smallWords)>-1&&":"!==title.charAt(index-2)&&("-"!==title.charAt(index+match.length)||"-"===title.charAt(index-1))&&title.charAt(index-1).search(/[^\s-]/)<0?match.toLowerCase():match.substr(1).search(/[A-Z]|\../)>-1?match:match.charAt(0).toUpperCase()+match.substr(1)})}}),PARTICLE.factory("dataIo",["$http","dataRigger","CONFIG","$sce",function($http,dataRigger,CONFIG,$sce){var dataIo={};return dataIo.getFile=function(_params){var searchData=dataRigger.getNew("file",_params);return $http({method:"GET",url:searchData.object.file,params:searchData.object})},dataIo.parseContent=function(obj){for(var property in obj)obj.hasOwnProperty(property)&&("object"==typeof obj[property]?this.parseContent(obj[property]):CONFIG.trustedHTML.inArray(property)&&(obj[property]=$sce.trustAsHtml(obj[property])));return obj},dataIo.xml2json=function(xml){var x2js=new X2JS,json=x2js.xml_str2json(xml);return json},dataIo}]).service("dataRigger",function(){this.getApiBaseUrl=function(_params){return"https://api.github.com/"},this.fillDataInObjectByList=function(_object,_params,_list){return angular.forEach(_list,function(value,key){angular.isDefined(_params[value])&&(_object.object[value]=_params[value])}),_object},this.getNew=function(_type,_params){var githubSearchData={object:{},url:""};switch(angular.isDefined(_params.per_page)&&(githubSearchData.object.per_page=_params.per_page),angular.isDefined(_params.access_token)&&(githubSearchData.object.access_token=_params.access_token),_type){case"file":githubSearchData=this.fillDataInObjectByList(githubSearchData,_params,["file"]);break;case"user":githubSearchData.object.per_page=void 0,githubSearchData=this.fillDataInObjectByList(githubSearchData,_params,[]),githubSearchData.url=this.getApiBaseUrl()+"users/"+_params.user;break;case"reposByUser":githubSearchData=this.fillDataInObjectByList(githubSearchData,_params,["q","sort","order","page"]),githubSearchData.url=this.getApiBaseUrl()+"users/"+_params.user+"/repos";break;case"reposByName":githubSearchData=this.fillDataInObjectByList(githubSearchData,_params,["sort","order","page"]),githubSearchData.url=this.getApiBaseUrl()+"search/repositories?q="+_params.q;break;case"repoByUserAndName":githubSearchData.object={access_token:_params.access_token},githubSearchData=this.fillDataInObjectByList(githubSearchData,_params,[]),githubSearchData.url=this.getApiBaseUrl()+"repos/"+_params.user+"/"+_params.repo;break;case"eventsByUser":githubSearchData=this.fillDataInObjectByList(githubSearchData,_params,["q","sort","order","page"]),githubSearchData.url=this.getApiBaseUrl()+"users/"+_params.user+"/events";break;case"eventsFromRepoByUserAndName":githubSearchData=this.fillDataInObjectByList(githubSearchData,_params,["q","sort","order","page"]),githubSearchData.url=this.getApiBaseUrl()+"repos/"+_params.user+"/"+_params.repo+"/events";break;case"fileByRepoName":githubSearchData.object={access_token:_params.access_token},githubSearchData=this.fillDataInObjectByList(githubSearchData,_params,[]),githubSearchData.url=this.getApiBaseUrl()+"repos/"+_params.user+"/"+_params.repo+"/contents/"+_params.path,console.log("githubSearchData.url",githubSearchData.url)}return githubSearchData}}),PARTICLE.factory("$datasource",["$http","$sce","$timeout",function($http,$sce,$timeout){var service={initialize:function(params,hash){decodeParams(params,hash)},getData:function(uri,params,hash){var config={params:params};return"undefined"!=typeof webSessionToken&&(config.headers={"X-Session-Token":webSessionToken.toString()}),encodeParams(params,hash),$http.get(uri,config).then(function(response){return response.data})},processData:function(raw,results,start_index,group_num){var ui_nodes=[],widCount=0,chunked_bits=[],group_by=3;return raw.hasOwnProperty("widgets")?(group_by=void 0!==raw.group_by?raw.group_by:group_by,chunked_bits=raw.widgets.chunk(group_by)):(group_by=group_num,chunked_bits=raw.chunk(group_by)),chunked_bits.forEach(function(nodes,indx){var children_to_process=[],common_children_group_class=start_index+"_"+indx+"_group",controlsChildren=0;nodes.forEach(function(node){node.toggle=1,node.id_class=start_index+"_"+widCount,widCount++,void 0!==node.primary_value&&(node.primary_value=resRef(results,node.primary_value)),void 0!==node.title&&(node.title=$sce.trustAsHtml(node.title)),void 0!==node.body&&(node.body=$sce.trustAsHtml(resRef(results,node.body))),void 0!==node.content&&"object"==typeof node.content&&Object.keys(node.content).forEach(function(key){void 0!==node.content[key].words&&("object"!=typeof node.content[key].words?node.content[key].words=$sce.trustAsHtml(resRef(results,node.content[key].words)):Object.keys(node.content[key].words).forEach(function(keyInner){node.content[key].words[keyInner]=$sce.trustAsHtml(resRef(results,node.content[key].words[keyInner]))})),void 0!==node.content[key].primary_value&&(node.content[key].primary_value=resRef(results,node.content[key].primary_value))});var mynewContainerWidget=new container_widget;if(node.hasOwnProperty("widgets")){controlsChildren=1,mynewContainerWidget.id_class=start_index+"_"+widCount;var pointerToWidgets=node.widgets;delete node.widgets,node.group_by=void 0!==node.group_by?node.group_by:group_by,mynewContainerWidget.widgets=service.processData(pointerToWidgets,results,mynewContainerWidget.id_class,node.group_by),mynewContainerWidget.label="Empty Container",mynewContainerWidget.toggle=1,"hidden"==node.children_initial_state&&(mynewContainerWidget.toggle=0),node.activates=mynewContainerWidget.id_class,node.hides=common_children_group_class,mynewContainerWidget.group_class=common_children_group_class,widCount++}"adjacent"!=node.position_hidden_children&&_isNotMobile||!controlsChildren?(controlsChildren&&children_to_process.push(mynewContainerWidget),ui_nodes.push(node)):(ui_nodes.push(node),ui_nodes.push(mynewContainerWidget)),controlsChildren=0}),children_to_process.forEach(function(node){ui_nodes.push(node)})}),ui_nodes}},container_widget=function(){this.title=null,this.type="empty_container",this.block_type="col-sm-12",this.primary_value=null,this.color_code=null,this.group_by=3,this.children_inital_state="show",this.widgets=null},encodeParams=function(params,hash){for(var param in params)"agencyCode"===param&&(hash.a=parseInt(params[param]));location.hash=$.param(hash)},decodeParams=function(params,hash){try{var json,str=decodeURIComponent(location.hash.substring(2));str&&(json=JSON.parse('{"'+str.replace(/&/g,'","').replace(/=/g,'":"')+'"}'),json&&"object"==typeof json&&null!==json&&(console.log("Parameters from URL hash string:",json),hash=json))}catch(e){console.log("URL hash string is invalid")}for(var param in hash)"a"===param&&(params.agencyCode=("000"+hash[param]).substring(hash[param].length))};return service}]),Object.defineProperty(Array.prototype,"chunk",{value:function(chunkSize){var array=this;return[].concat.apply([],array.map(function(elem,i){return i%chunkSize?[]:[array.slice(i,i+chunkSize)]}))}}),Array.prototype.inArray=function(needle){return this.indexOf(needle)!=-1},String.prototype.replaceAll=function(search,replacement){var target=this;return target.split(search).join(replacement)};var _isNotMobile=function(){var check=!1;return function(a){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))&&(check=!0);
}(navigator.userAgent||navigator.vendor||window.opera),!check}();Math.easeOutBounce=function(pos){return pos<1/2.75?7.5625*pos*pos:pos<2/2.75?7.5625*(pos-=1.5/2.75)*pos+.75:pos<2.5/2.75?7.5625*(pos-=2.25/2.75)*pos+.9375:7.5625*(pos-=2.625/2.75)*pos+.984375},function(){var initInjector=angular.injector(["ng"]),$http=initInjector.get("$http");return $http.get("app-config.json").then(function(response){var SETTINGS=response.data;$http.get(SETTINGS.navigationFile).then(function(response){SETTINGS.nav={},SETTINGS.nav=response.data.sort(dynamicSort("sortOrder")),PARTICLE.constant("CONFIG",SETTINGS)}).then(function(){angular.bootstrap(document.body,["PARTICLE"]),angular.element(document).ready(function(){})})["catch"](function(data){console.log("Unable to load: ",SETTINGS.navigationFile,data)})})["catch"](function(data){console.log("Unable to load app-configs.json")})}();
//# sourceMappingURL=particle.min.js.map
